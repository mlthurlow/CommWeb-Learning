<!-- Wappler include head-page="layouts/main" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="pagecontent" appConnect="local" components="{dmxBootstrap5TableGenerator:{},dmxBootstrap5Modal:{},dmxNotifications:{},dmxDropzone:{},dmxValidator:{},dmxSummernote:{},dmxSummernoteFileUpload:{},dmxFormRepeat:{},dmxFormatter:{}}" jquery_slim_35="cdn" -->
<dmx-notifications id="notifies1"></dmx-notifications>
<dmx-serverconnect id="conn_single_page" url="/api/pagedata/get_single_page_data" noload="true"></dmx-serverconnect>
<dmx-serverconnect id="conn_pagedata" url="/api/pagedata/get_page_data" dmx-param:pagetype="id_pagetype.value"></dmx-serverconnect>
<dmx-serverconnect id="conn_pagetypes" url="/api/pagedata/all_page_types"></dmx-serverconnect>
<div class="modal" id="modal1" is="dmx-bs5-modal" tabindex="-1" dmx-on:hide-bs-modal="serverconnectform1.reset()">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Edit Page Data</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form is="dmx-serverconnect-form" id="serverconnectform1" method="post" action="/api/pagedata/update_page_data" dmx-generator="bootstrap5" dmx-form-type="horizontal" dmx-populate="conn_single_page.data.query" dmx-on:success="notifies1.success('Content Updated');serverconnectform1.reset();modal1.hide();conn_pagedata.load({})">
                    <input type="hidden" name="pagecontent_id" id="inp_pagecontent_id" dmx-bind:value="conn_single_page.data.query.pagecontent_id" dmxorgdomid="d392"><input type="hidden" name="pagetype" id="inp_pagetype" dmx-bind:value="conn_single_page.data.query.pagetype" dmxorgdomid="d393">
                    <div class="form-group mb-3 row">
                        <label for="inp_title" class="col-sm-2 col-form-label">Title</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="inp_title" name="title" dmx-bind:value="conn_single_page.data.query.title" aria-describedby="inp_title_help" placeholder="Enter Title" dmxorgdomid="d397">
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <label for="inp_description_old" class="col-sm-2 col-form-label">Description</label>
                        <div class="col-sm-10">
                            <textarea id="editor1" name="description" is="dmx-summernote" dmx-bind:toolbar="[['style',['style']],['font',['bold','underline','clear','italic']],['fontname',['fontname']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','imageFile']],['view',['fullscreen','codeview','help']]]" dmx-bind:value="conn_single_page.data.query.description" dmx-plugin:file="{imageUrl:'/api/pagedata/images/summernote_upload'}"></textarea>
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <label for="inp_event_start" class="col-sm-2 col-form-label">Event start</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="inp_event_start" name="event_start" dmx-bind:value="conn_single_page.data.query.event_start" aria-describedby="inp_event_start_help" placeholder="Enter Event start" dmxorgdomid="d405">
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <label for="inp_event_end" class="col-sm-2 col-form-label">Event end</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="inp_event_end" name="event_end" dmx-bind:value="conn_single_page.data.query.event_end" aria-describedby="inp_event_end_help" placeholder="Enter Event end" dmxorgdomid="d409">
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <label for="inp_lat" class="col-sm-2 col-form-label">Lat</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="inp_lat" name="lat" dmx-bind:value="conn_single_page.data.query.lat" aria-describedby="inp_lat_help" placeholder="Enter Lat" dmxorgdomid="d413">
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <label for="inp_long" class="col-sm-2 col-form-label">Long</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="inp_long" name="long" dmx-bind:value="conn_single_page.data.query.long" aria-describedby="inp_long_help" placeholder="Enter Long" dmxorgdomid="d417">
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <legend class="col-sm-2 col-form-label">Geo</legend>
                        <div class="col-sm-10">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="inp_geo" name="geo" dmxorgdomid="d422" dmx-bind:checked="conn_single_page.data.query.geo">
                                <label class="form-check-label" for="inp_geo">Geo</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <legend class="col-sm-2 col-form-label">Online</legend>
                        <div class="col-sm-10">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="1" id="inp_online" name="online" dmxorgdomid="d428" dmx-bind:checked="conn_single_page.data.query.online">
                                <label class="form-check-label" for="inp_online">Online</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <div class="col-sm-2">&nbsp;</div>
                        <div class="col-sm-10">
                            <button type="submit" class="btn btn-primary" dmx-bind:value="conn_single_page.data.query.Save" dmx-bind:disabled="state.executing" dmxorgdomid="d433">Save <span class="spinner-border spinner-border-sm" role="status" dmx-show="state.executing" dmxorgdomid="d434"></span></button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="modal_add_image" is="dmx-bs5-modal" tabindex="-1">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title">Image Upload</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex">
                    <form id="form_update_order" is="dmx-serverconnect-form" method="post">
                        <div is="dmx-form-repeat" id="formRepeat1" dmx-bind:items="conn_single_page.data.query.images" sortable="true" animation="500" handle=".handle">
                            <div class="d-flex">
                                <button id="btn_sorter" class="sorter.handle">
                                    <i class="fas fa-bars fa-lg"></i></button>
                                <img dmx-bind:src="'/uploads/pageimages/'+conn_single_page.data.query.pagecontent_id+'/cover/'+conn_single_page.data.query.images[0].imagelink">
                            </div>
                        </div>
                    </form>
                </div>
                <form id="form_upload" is="dmx-serverconnect-form" method="post" action="/api/pagedata/images/upload_image" dmx-on:success="notifies1.success('Uploaded!');modal_add_image.hide();conn_single_page.load({pagecontent_id: conn_single_page.data.query.pagecontent_id})">
                    <div class="form-group mb-3 row">
                        <label for="pagecontent_id" class="col-sm-2 col-form-label"></label>
                        <div class="col-sm-10">
                            <input type="hidden" class="form-control" id="pagecontent_id" name="pagecontent_id" aria-describedby="input1_help" placeholder="Enter some text" dmx-bind:value="conn_single_page.data.query.pagecontent_id">
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <label for="input2" class="col-sm-2 col-form-label">Image upload</label>
                        <div class="col-sm-10">

                            <input type="file" class="form-control" id="input2" name="file[]" aria-describedby="input2_help" multiple="true" is="dmx-dropzone" accept=".jpg,.jpeg,.png">
                        </div>
                    </div>
                    <div class="form-group mb-3 row">
                        <div class="col-sm-2">&nbsp;</div>
                        <div class="col-sm-10">
                            <button id="btn1_submit" type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </div>
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="container mt-3">
    <div class="row">
        <div class="col">
            <select id="id_pagetype" class="form-select" dmx-bind:options="conn_pagetypes.data.query" optiontext="rolename" optionvalue="role" name="pagetype">
            </select>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col">
            <button id="btn_new" class="btn w-100 btn-primary" dmx-on:click="run([{serverConnect:{name:'sc',outputType:'object',url:'/api/pagedata/new_page',site:'Community Web',params:{pagetype:`id_pagetype.value`}}},{run:{outputType:'text',action:`conn_pagedata.load({pagetype: id_pagetype.value})`}}])">New Page of this Type</button>
        </div>
    </div>
</div>
<div class="mt-3 container-fluid">
    <div class="row">
        <div class="col">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover table-sm">
                    <thead>
                        <tr>
                            <th scope="row"></th>
                            <th scope="row"></th>
                            <th>Pagecontent</th>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Online</th>
                            <th>Date created</th>
                            <th>Date edited</th>
                            <th>Event start</th>
                            <th>Lat</th>
                            <th>Long</th>
                            <th>Geo</th>
                            <th>Pagetype</th>
                            <th>Event end</th>
                            <th>Creator</th>
                            <th>Last editor</th>
                            <th>C first name</th>
                            <th>C last name</th>
                            <th>E first name</th>
                            <th>E last name</th>
                        </tr>
                    </thead>
                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="conn_pagedata.data.query" id="tableRepeat1">
                        <tr>
                            <td>
                                <button id="btn_edit" class="btn btn-success w-100" dmx-on:click="conn_single_page.load({pagecontent_id: pagecontent_id});modal1.show()"><i class="fas fa-edit fa-lg"></i></button>
                            </td>
                            <td>
                                <button id="btn_images" class="btn btn-info" dmx-on:click="conn_single_page.load({pagecontent_id: pagecontent_id})" data-bs-toggle="modal" data-bs-target="#modal_add_image">
                                    <i class="fas fa-image fa-lg"></i></button>
                            </td>
                            <td dmx-text="pagecontent_id"></td>
                            <td dmx-text="title"></td>
                            <td dmx-text="description"></td>
                            <td dmx-text="online"></td>
                            <td dmx-text="date_created"></td>
                            <td dmx-text="date_edited"></td>
                            <td dmx-text="event_start"></td>
                            <td dmx-text="lat"></td>
                            <td dmx-text="long"></td>
                            <td dmx-text="geo"></td>
                            <td dmx-text="pagetype"></td>
                            <td dmx-text="event_end"></td>
                            <td dmx-text="creator_id"></td>
                            <td dmx-text="last_editor_id"></td>
                            <td dmx-text="c_first_name"></td>
                            <td dmx-text="c_last_name"></td>
                            <td dmx-text="e_first_name"></td>
                            <td dmx-text="e_last_name"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<meta name="ac:route" content="/pagecontent">